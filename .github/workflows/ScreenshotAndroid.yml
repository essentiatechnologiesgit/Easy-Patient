name: Take Screenshots

on:
  push:
    branches:
      - FixesForiOSBuild

jobs:
  take-screenshots:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Install dependencies
        run: npm ci

      - name: Run Puppeteer to take screenshots
        run: |
          cat <<EOF > takeScreenshots.js
          const puppeteer = require('puppeteer');
          const fs = require('fs');
          const path = require('path');
          const devices = puppeteer.devices;
          const iPhone = devices['iPhone 14'];

          (async () => {
            const browser = await puppeteer.launch();
            const page = await browser.newPage();
            await page.emulate(iPhone);

            // Use GitHub workspace environment variable for the file path
            const filePaths = [path.resolve(process.env.GITHUB_WORKSPACE, '.github/workflows', 'page1.html')];

            const screenshots = [];

            for (let i = 0; i < filePaths.length; i++) {
              await page.goto('file://' + filePaths[i]);
              const screenshotFileName = 'screenshot-iphone14-' + (i + 1) + '.png';
              await page.screenshot({ path: screenshotFileName });
              screenshots.push(screenshotFileName);
            }

            await browser.close();
            console.log('Screenshots taken successfully!');
          })();
          EOF

      - name: Run Puppeteer Script
        run: node takeScreenshots.js

      - name: Upload screenshots as artifacts
        uses: actions/upload-artifact@v3
        with:
          name: screenshots
          path: screenshot-iphone14-*.png
